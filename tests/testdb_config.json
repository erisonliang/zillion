{
    "facts": [
        {
            "name": "rpl",
            "aggregation": "avg",
            "rounding": 2,
            "formula": "{revenue}/{leads}"
        },
        {
            "name": "rpl_weighted",
            "aggregation": "avg",
            "rounding": 2,
            "formula": "{revenue}/{leads}",
            "weighting_fact": "sales_quantity"
        },
        {
            "name": "rpl_squared",
            "aggregation": "avg",
            "rounding": 2,
            "formula": "{rpl}*{rpl}"
        },
        {
            "name": "rpl_unsquared",
            "aggregation": "avg",
            "rounding": 2,
            "formula": "{rpl_squared}/{rpl}"
        },
        {
            "name": "rpl_ma_5",
            "aggregation": "avg",
            "rounding": 2,
            "formula": "{revenue}/{leads}",
            "technical": "MA-5"
        },
        {
            "name": "revenue",
            "type": "Numeric(10,2)",
            "aggregation": "sum",
            "rounding": 2
        },
        {
            "name": "revenue_ma_5",
            "type": "Numeric(10,2)",
            "aggregation": "sum",
            "rounding": 2,
            "technical": "MA-5"
        },
        {
            "name": "revenue_sum_5",
            "type": "Numeric(10,2)",
            "aggregation": "sum",
            "rounding": 2,
            "technical": "SUM-5"
        },
        {
            "name": "revenue_boll_5",
            "type": "Numeric(10,2)",
            "aggregation": "sum",
            "rounding": 2,
            "technical": "BOLL-5"
        },
        {
            "name": "revenue_ds",
            "type": "Numeric(10,2)",
            "aggregation": "sum",
            "rounding": 2
        },
        {
            "name": "revenue_avg",
            "type": "Numeric(10,2)",
            "aggregation": "avg",
            "rounding": 2,
            "weighting_fact": "sales_quantity"
        },
        {
            "name": "revenue_avg_ds_weighted",
            "type": "Numeric(10,2)",
            "aggregation": "avg",
            "rounding": 2,
            "weighting_fact": "sales_quantity"
        },
        {
            "name": "leads",
            "type": "Integer",
            "aggregation": "count_distinct"
        },
        {
            "name": "sales",
            "type": "Integer",
            "aggregation": "count_distinct"
        }
    ],

    "dimensions": [
        {
            "name": "partner_name",
            "type": "String(32)"
        },
        {
            "name": "revenue_decile",
            "type": "Integer"
        }
    ],
    
    "datasources": {
        "testdb": {
            "tables": {
                "partners": {
                    "type": "dimension",
                    "autocolumns": true,
                    "columns": {
                        "id": {
                            "fields": ["partner_id"]
                        },
                        "name": {
                            "fields": ["partner_name"]
                        }
                    }
                },
                
                "campaigns": {
                    "type": "dimension",
                    "autocolumns": true,
                    "parent": "partners",
                    "columns": {
                        "id": {
                            "fields": ["campaign_id"]
                        },
                        "name": {
                            "fields": ["campaign_name"]
                        },
                        "partner_id": {
                            "fields": ["partner_id"]
                        }
                    }
                },

                "leads": {
                    "type": "fact",
                    "autocolumns": true,
                    "columns": {
                        "id": {
                            "fields": ["lead_id", "leads"]
                        },
                        "created_at": {
                            "allow_type_conversions": true
                        },
                        "campaign_id": {
                            "fields": ["campaign_id"]
                        }
                    }
                },
                
                "sales": {
                    "type": "fact",
                    "autocolumns": true,
                    "parent": "leads",
                    "columns": {
                        "id": {
                            "fields": ["sale_id", "sales"]
                        },
                        "created_at": {
                            "allow_type_conversions": true
                        },
                        "lead_id": {
                            "fields": ["lead_id"]
                        },
                        "revenue": {
                            "fields": [
                                "revenue",
                                "revenue_ma_5",
                                "revenue_sum_5",
                                "revenue_boll_5",
                                {"name": "revenue_ds", "ds_formula": "IFNULL(sales.revenue, 0)"},
                                "revenue_avg",
                                {"name": "revenue_avg_ds_weighted", "ds_formula": "SUM(1.0*sales.revenue*sales.quantity)/SUM(sales.quantity)"},
                                {"name": "revenue_decile", "ds_formula": "10*ROUND(sales.revenue/10.0, 0)"}
                            ]
                        }
                    }
                }
            }
        }
    }
}
